#!/usr/bin/env node

const { cd, pwd } = require('shelljs')
const { basename, resolve } = require('path')
const { trim } = require('lodash')
const { command } = require('@mosteast/command')

require('yargs').command({
  command: '$0 <repo_uri> [dir] [--keep_origin] [--keep_branch]',
  describe: 'Clone and parenting a repository',
  async handler({ repo_uri, dir, keep_origin, keep_branch }) {
    const wd = pwd().toString()
    const repo = basename(trim(repo_uri, '/'), '.git')

    if (!dir) {
      dir = resolve(wd, repo)
    }

    await command(`hub clone ${repo_uri} ${dir}`)

    cd(dir)

    if (!keep_origin) {
      await command(`git remote rename origin parent`)
    }

    if (!keep_branch) {
      await command(`git branch -m master parent`)
    }
  },
}).argv
