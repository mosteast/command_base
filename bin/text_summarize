#!/usr/bin/env node

"use strict";

const path = require("path");

const {
  run_text_prompt_batch_cli,
} = require("../utility/text_prompt_batch_runner");

const command_name = path.basename(process.argv[1] || "text_summarize");
const repo_root_path = path.resolve(__dirname, "..");
const prompt_external_path =
  "/Users/hailang/Library/Mobile Documents/com~apple~CloudDocs/main/download/tool/prompt/summarize_text.build.md";

(async () => {
  await run_text_prompt_batch_cli({
    command_name,
    description_lines: [
      "Summarize one or more files with the summarize_text prompt.",
      "Writes `[filename.ext].summarized.md` alongside each input file.",
    ],
    job_title: "Summarization",
    job_noun: "summarization",
    present_progress_label: "Summarizing",
    past_tense_summary_label: "summarized",
    output_suffix: ".summarized.md",
    generated_suffixes: [".summarized.md"],
    generated_file_skip_reason: "already summarized",
    existing_output_skip_reason: "existing output",
    prompt_name: "summarize_text",
    prompt_external_path,
    repo_root_path,
    default_batch_size: 5,
    default_retry_count: 3,
    examples: [
      {
        description:
          "Summarize every Markdown file inside the notes directory tree",
        command: "$0 notes/**/*.md",
      },
      {
        description:
          "Regenerate the summary for report.md even if it already exists",
        command: "$0 report.md --refresh",
      },
      {
        description:
          "Process multiple files concurrently with a custom batch size",
        command: "$0 drafts/*.md --batch-size 5",
      },
    ],
  });
})().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
